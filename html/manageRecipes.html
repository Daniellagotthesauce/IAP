<script>
    // Function to parse query parameters from the URL
    function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
    }

    async function fetchUserRecipes() {
        const userID = getQueryParam('userID'); // Get userID from the query parameter

        if (!userID) {
            alert('User ID not provided. Please log in again.');
            window.location.href = 'login.html'; // Redirect to login if no userID is found
            return;
        }

        try {
            const response = await fetch(`http://localhost:4000/get-user-recipes?userID=${userID}`);
            if (!response.ok) {
                throw new Error('Failed to fetch user recipes');
            }

            const recipes = await response.json();
            const recipeContainer = document.getElementById('recipeContainer');
            recipeContainer.innerHTML = ''; // Clear loading message

            if (recipes.length === 0) {
                recipeContainer.innerHTML = '<p>You have no recipes yet.</p>';
                return;
            }

            recipes.forEach(recipe => {
                const card = document.createElement('div');
                card.classList.add('recipe-card');
                card.innerHTML = `
                    <h3>${recipe.Title}</h3>
                    <p>${recipe.Description}</p>
                    <div class="actions">
                        <button onclick="editRecipe(${recipe.RecipeID})">Edit</button>
                        <button onclick="deleteRecipe(${recipe.RecipeID})" class="delete">Delete</button>
                    </div>
                `;
                recipeContainer.appendChild(card);
            });
        } catch (error) {
            console.error('Error fetching user recipes:', error);
            alert('Failed to load your recipes. Please try again later.');
        }
    }

    function editRecipe(recipeID) {
        window.location.href = `editRecipe.html?RecipeID=${recipeID}`;
    }

    async function deleteRecipe(recipeID) {
        if (confirm('Are you sure you want to delete this recipe?')) {
            try {
                const response = await fetch(`http://localhost:4000/delete-recipe/${recipeID}`, {
                    method: 'DELETE',
                });

                if (response.ok) {
                    alert('Recipe deleted successfully!');
                    fetchUserRecipes(); // Refresh the list
                } else {
                    alert('Failed to delete recipe.');
                }
            } catch (error) {
                console.error('Error deleting recipe:', error);
                alert('An error occurred while deleting the recipe.');
            }
        }
    }

    document.addEventListener('DOMContentLoaded', fetchUserRecipes);
</script>