<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Recipes</title>
    <link rel="stylesheet" href="../css/manageRecipes.css">
</head>
<body>
    <header>
        <div class="Logo">
            <img src="../images/logo.png" alt="Logo">
        </div>
        <nav class="Links">
            <a href="homepage.html">Home</a>
            <a href="addRecipe.html">Add Recipe</a>
            <a href="manageRecipes.html" class="active">Manage Recipes</a>
        </nav>
    </header>

    <h2>Manage Your Recipes</h2>
    <div class="recipe-container" id="manageRecipeContainer"></div>

    <script>
        async function fetchUserRecipes() {
            try {
                const response = await fetch('http://localhost:4000/get-user-recipes'); // Adjust endpoint as needed
                const recipes = await response.json();

                console.log("User Recipes:", recipes);

                const recipeContainer = document.getElementById('manageRecipeContainer');
                recipeContainer.innerHTML = '';

                recipes.forEach(recipe => {
                    const card = document.createElement('div');
                    card.classList.add('recipe-card');

                    card.innerHTML = `
                        <div class="recipe-title">${recipe.Title}</div>
                        <div class="recipe-category">Category: ${recipe.Category || 'Unknown'}</div>
                        <div class="recipe-actions">
                            <button onclick="viewRecipe(${recipe.RecipeID})">View</button>
                            <button onclick="modifyRecipe(${recipe.RecipeID})">Modify</button>
                            <button onclick="deleteRecipe(${recipe.RecipeID})" class="delete-btn">Delete</button>
                        </div>
                    `;

                    recipeContainer.appendChild(card);
                });
            } catch (error) {
                console.error('Error fetching user recipes:', error);
            }
        }

        function viewRecipe(recipeID) {
            window.location.href = `recipeDetails.html?RecipeID=${recipeID}`;
        }

        function modifyRecipe(recipeID) {
            window.location.href = `editRecipe.html?RecipeID=${recipeID}`;
        }

        async function deleteRecipe(recipeID) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                try {
                    const response = await fetch(`http://localhost:4000/delete-recipe/${recipeID}`, {
                        method: 'DELETE',
                    });

                    if (response.ok) {
                        alert('Recipe deleted successfully!');
                        fetchUserRecipes(); // Refresh the list
                    } else {
                        alert('Failed to delete recipe.');
                    }
                } catch (error) {
                    console.error('Error deleting recipe:', error);
                    alert('An error occurred while deleting the recipe.');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', fetchUserRecipes);
    </script>
</body>
</html>
